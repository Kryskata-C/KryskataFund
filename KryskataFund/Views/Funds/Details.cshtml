@model KryskataFund.Models.Fund
@{
    ViewData["Title"] = Model.Title;
    var progressPercent = Model.ProgressPercent;
    var isOverfunded = Model.RaisedAmount > Model.GoalAmount;
    var statusText = isOverfunded ? $"{progressPercent}% funded" : Model.DaysLeft == 0 ? "Ended" : $"{Model.DaysLeft} days left";
    var isSignedIn = ViewBag.IsSignedIn ?? false;
    var signInUrl = Url.Action("SignIn", "Account", new { returnUrl = Context.Request.Path });
}

<div class="page-root">
    <div class="page-shell">
        <!-- Back button -->
        <a asp-controller="Home" asp-action="Index" class="back-link">
            <span class="back-arrow">‚Üê</span>
            Back to campaigns
        </a>

        <div class="fund-detail-grid">
            <!-- Main content -->
            <section class="fund-detail-main">
                <!-- Hero image area -->
                <div class="fund-detail-hero">
                    <div class="fund-detail-hero-gradient"></div>
                    <div class="fund-detail-category-tag" style="--cat-color: @Model.CategoryColor;">
                        <span class="fund-detail-tag-dot" style="background: @Model.CategoryColor; box-shadow: 0 0 10px @Model.CategoryColor;"></span>
                        @Model.Category
                    </div>
                    @if (isOverfunded)
                    {
                        <div class="fund-detail-badge fund-detail-badge--success">
                            Goal reached!
                        </div>
                    }
                </div>

                <!-- Title and story -->
                <div class="fund-detail-content">
                    <h1 class="fund-detail-title">@Model.Title</h1>

                    <div class="fund-detail-creator">
                        <div class="fund-detail-avatar" style="background: linear-gradient(135deg, @Model.CategoryColor, #4da8ff);"></div>
                        <span>Created by <strong>@Model.CreatorName</strong></span>
                    </div>

                    <div class="fund-detail-story">
                        <h2>About this campaign</h2>
                        <p>@Model.Description</p>
                    </div>

                    <!-- Updates section (placeholder) -->
                    <div class="fund-detail-updates">
                        <h2>Updates</h2>
                        <div class="fund-detail-update-empty">
                            <span>No updates yet</span>
                            <p>The creator hasn't posted any updates for this campaign.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Sidebar with donation -->
            <aside class="fund-detail-sidebar">
                <div class="fund-detail-card">
                    <!-- Progress section -->
                    <div class="fund-detail-progress-section">
                        <div class="fund-detail-amount">
                            <span class="fund-detail-raised">‚Ç¨@Model.RaisedAmount.ToString("N0")</span>
                            <span class="fund-detail-goal">raised of ‚Ç¨@Model.GoalAmount.ToString("N0") goal</span>
                        </div>

                        <div class="fund-detail-progress-bar">
                            <div class="fund-detail-progress-fill" style="--progress: @Math.Min(100, progressPercent)%;"></div>
                        </div>

                        <div class="fund-detail-stats">
                            <div class="fund-detail-stat">
                                <span class="fund-detail-stat-value">@Model.SupportersCount</span>
                                <span class="fund-detail-stat-label">supporters</span>
                            </div>
                            <div class="fund-detail-stat">
                                <span class="fund-detail-stat-value">@progressPercent%</span>
                                <span class="fund-detail-stat-label">funded</span>
                            </div>
                            <div class="fund-detail-stat">
                                <span class="fund-detail-stat-value">@(Model.DaysLeft == 0 ? "Ended" : Model.DaysLeft.ToString())</span>
                                <span class="fund-detail-stat-label">@(Model.DaysLeft == 0 ? "" : "days left")</span>
                            </div>
                        </div>
                    </div>

                    <!-- Donation buttons -->
                    <div class="fund-detail-donate-section">
                        <div class="fund-detail-quick-amounts">
                            <button class="btn-quick-amount" data-amount="10">‚Ç¨10</button>
                            <button class="btn-quick-amount" data-amount="25">‚Ç¨25</button>
                            <button class="btn-quick-amount" data-amount="50">‚Ç¨50</button>
                            <button class="btn-quick-amount" data-amount="100">‚Ç¨100</button>
                            <div class="btn-custom-amount">
                                <span class="custom-amount-label">‚Ç¨</span>
                                <input type="number" class="custom-amount-input" placeholder="Custom" min="1" id="customAmount">
                            </div>
                        </div>

                        <div class="selected-amount-display" id="selectedAmountDisplay">
                            <span class="selected-amount-label">Your donation</span>
                            <span class="selected-amount-value">‚Ç¨<span id="animatedAmount">0</span></span>
                        </div>

                        <button class="btn-donate btn-donate--primary" id="donateBtn">
                            <span class="btn-donate-icon">üíö</span>
                            Donate now
                        </button>

                        <button class="btn-donate btn-donate--ghost">
                            <span class="btn-donate-icon">üîó</span>
                            Share campaign
                        </button>
                    </div>

                    <!-- Recent supporters -->
                    <div class="fund-detail-supporters">
                        <h3>Recent supporters</h3>
                        <div class="fund-detail-supporter-list">
                            <div class="fund-detail-supporter">
                                <div class="fund-detail-supporter-avatar" style="background: linear-gradient(135deg, #22c55e, #4ade80);"></div>
                                <div class="fund-detail-supporter-info">
                                    <span class="fund-detail-supporter-name">Anonymous</span>
                                    <span class="fund-detail-supporter-amount">‚Ç¨50</span>
                                </div>
                                <span class="fund-detail-supporter-time">2 hours ago</span>
                            </div>
                            <div class="fund-detail-supporter">
                                <div class="fund-detail-supporter-avatar" style="background: linear-gradient(135deg, #4f46e5, #22d3ee);"></div>
                                <div class="fund-detail-supporter-info">
                                    <span class="fund-detail-supporter-name">Maria K.</span>
                                    <span class="fund-detail-supporter-amount">‚Ç¨25</span>
                                </div>
                                <span class="fund-detail-supporter-time">5 hours ago</span>
                            </div>
                            <div class="fund-detail-supporter">
                                <div class="fund-detail-supporter-avatar" style="background: linear-gradient(135deg, #f97316, #fb7185);"></div>
                                <div class="fund-detail-supporter-info">
                                    <span class="fund-detail-supporter-name">Stefan P.</span>
                                    <span class="fund-detail-supporter-amount">‚Ç¨100</span>
                                </div>
                                <span class="fund-detail-supporter-time">1 day ago</span>
                            </div>
                        </div>
                        <a href="#" class="fund-detail-see-all">See all @Model.SupportersCount supporters ‚Üí</a>
                    </div>
                </div>
            </aside>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const quickAmountBtns = document.querySelectorAll('.btn-quick-amount');
            const customAmountInput = document.getElementById('customAmount');
            const selectedAmountDisplay = document.getElementById('selectedAmountDisplay');
            const animatedAmountSpan = document.getElementById('animatedAmount');
            const donateBtn = document.getElementById('donateBtn');

            let currentAmount = 0;
            let isAnimating = false;

            // Count up animation function
            function animateCountUp(targetAmount, duration = 600) {
                if (isAnimating) return;
                isAnimating = true;

                const startAmount = 0;
                const startTime = performance.now();

                // Show the display with animation
                selectedAmountDisplay.classList.add('visible');

                function updateCount(currentTime) {
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    // Easing function (ease out cubic)
                    const easeProgress = 1 - Math.pow(1 - progress, 3);

                    const currentValue = Math.floor(startAmount + (targetAmount - startAmount) * easeProgress);
                    animatedAmountSpan.textContent = currentValue;

                    if (progress < 1) {
                        requestAnimationFrame(updateCount);
                    } else {
                        animatedAmountSpan.textContent = targetAmount;
                        isAnimating = false;
                    }
                }

                requestAnimationFrame(updateCount);
            }

            // Handle quick amount button clicks
            quickAmountBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    // Remove active class from all buttons
                    quickAmountBtns.forEach(b => b.classList.remove('active'));
                    customAmountInput.classList.remove('active');
                    customAmountInput.value = '';

                    // Add active class to clicked button
                    this.classList.add('active');

                    const amount = parseInt(this.dataset.amount);
                    currentAmount = amount;
                    animateCountUp(amount);
                });
            });

            // Handle custom amount input
            customAmountInput.addEventListener('input', function() {
                quickAmountBtns.forEach(b => b.classList.remove('active'));

                const amount = parseInt(this.value) || 0;
                if (amount > 0) {
                    this.classList.add('active');
                    currentAmount = amount;
                    animateCountUp(amount);
                } else {
                    this.classList.remove('active');
                    selectedAmountDisplay.classList.remove('visible');
                }
            });

            customAmountInput.addEventListener('focus', function() {
                quickAmountBtns.forEach(b => b.classList.remove('active'));
            });

            // Handle donate button click
            const fundId = @Model.Id;

            donateBtn.addEventListener('click', function() {
                if (currentAmount > 0) {
                    // Redirect to payment page
                    window.location.href = '/Funds/Donate?id=' + fundId + '&amount=' + currentAmount;
                } else {
                    // Shake animation if no amount selected
                    selectedAmountDisplay.classList.add('shake');
                    setTimeout(() => selectedAmountDisplay.classList.remove('shake'), 500);
                }
            });
        });
    </script>
}
